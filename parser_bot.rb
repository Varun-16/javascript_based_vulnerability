require 'open-uri'
require 'nokogiri'
require_relative 'app.rb'

Xsssite.all.each do |site|
	if site.category.strip != "XSS"
		next
	end
	begin
		if site.status.length == 9
			html = Nokogiri::HTML(open(site.mirror).read)
		else
	    html = Nokogiri::HTML(open(site.url.to_s.strip).read)
		end
		html.css('script').each do |script|
		    if not script.content.empty?
				  #Data here
				  js_script = Script.new
				  js_script.content = script.content.strip
				  js_script.xsssite_id = site.id
		      puts script.content.strip
		      js_script.save
		    end
		end
	rescue 
		puts "NOT able to open #{site.url}"
	end
end
