require 'open-uri'
require 'nokogiri'
require_relative 'app.rb'

def get_script html,type,site
	html.css('script').each do |script|
	    if not script.content.empty?
		  #Data here
			  js_script = Script.new
			  js_script.content = script.content.strip
			  js_script.xsssite_id = site.id
			  js_script.script_type = type
	      puts script.content.strip
	      js_script.save
	    end
	end
end


Xsssite.all.each do |site|
	if site.category.strip != "XSS"
		next
	end
	begin
		html = Nokogiri::HTML(open(site.mirror).read)
		get_script html,"Vulnerable",site
    html = Nokogiri::HTML(open(site.url.to_s.strip).read)
    get_script html,"Not Vulnerable",site
	rescue 
		puts "NOT able to open #{site.url}"
	end
end
