require 'mechanize'
require_relative 'app.rb'


#Most of them might be vulnerable

def get_data url
  browser = Mechanize.new
  base_url = "http://www.xssed.com/"
  for i  in (1..2)
    page = browser.get(base_url+"#{url}=#{i}")
    page.links_with(text: /mirror/).each do |link|
      # puts link.href
      page2 = browser.get(base_url+link.href)
      mirror_link = page2.link_with(text: /Click here to view the mirror/).href
      site = Xsssite.new
      (page2/".row3").each do |f|
        tmp=f.text.split(":")
  			if tmp.size > 1
          site.get_data(tmp)
        end
      end
      site.mirror = mirror_link
      site.save
    end
  end
end

get_data "archive/special"
get_data "archive/fixed"